# Governance Framework

Defines the rules, roles, and decision-making structure for all autonomous
and human-initiated operations within the Infinity X One Systems organization,
as managed by the Infinity Orchestrator.

---

## 1. Scope

This governance framework applies to:
- All GitHub repositories under `Infinity-X-One-Systems`
- All actions taken by the `infinity-orchestrator` GitHub App
- All workflows executing inside `infinity-orchestrator`
- All external connectors (Cloudflare, OpenAI, VS Code, etc.)
- All human contributors who interact with governed systems

---

## 2. Role Hierarchy

| Role | Actor | Capabilities |
|------|-------|-------------|
| **Sovereign Owner** | `InfinityXOneSystems` (personal account) | Unrestricted; can override any policy |
| **Org Admin** | Org admin accounts in `Infinity-X-One-Systems` | Manage org settings, billing, members |
| **Orchestrator App** | `infinity-orchestrator` GitHub App | Autonomous operations within granted permissions |
| **Workflow Bot** | `github-actions[bot]` | Commits, PRs, and issues within workflow scope |
| **Genesis Agent** | Python agents in `stacks/genesis/` | Code generation, PR creation, validation |
| **Autonomous Engine** | Agents in `stacks/agents/` | Discovery, scoring, sandbox, reporting |
| **Contributor** | Human developers | PRs, issues, and code review |

---

## 3. Decision Matrix

| Action | Orchestrator App | Workflow Bot | Genesis Agent | Human Required |
|--------|:---:|:---:|:---:|:---:|
| Create feature branch | ✅ | ✅ | ✅ | ❌ |
| Commit code changes | ✅ | ✅ | ✅ | ❌ |
| Open PR | ✅ | ✅ | ✅ | ❌ |
| Auto-merge PR (TAP passed) | ✅ | ✅ | ✅ | ❌ |
| Delete branch | ✅ | ✅ | ✅ | ❌ |
| Create repository | ✅ | ❌ | ❌ | ⚠️ Log required |
| Delete repository | ✅ | ❌ | ❌ | ✅ Always |
| Manage branch protection | ✅ | ❌ | ❌ | ⚠️ Log required |
| Add/remove org members | ✅ | ❌ | ❌ | ✅ Always |
| Modify billing settings | ❌ | ❌ | ❌ | ✅ Always |
| Rotate GitHub App key | ❌ | ❌ | ❌ | ✅ Always |
| Modify governance policies | ❌ | ❌ | ❌ | ✅ Always |
| Deploy to production | ✅ | ❌ | ❌ | ⚠️ After TAP |
| Cloudflare DNS changes | ✅ | ❌ | ❌ | ⚠️ Log required |
| Cloudflare delete zone | ❌ | ❌ | ❌ | ✅ Always |

> ⚠️ "Log required" means the action is automated but must create a tracking
> issue and a telemetry record before executing.

---

## 4. Repository Governance Rules

### 4.1 Branch Model
All repositories under `Infinity-X-One-Systems` follow this branch model:

```
main           ← Protected; requires PR + passing checks
  ↑
  feature/*    ← Agent or human feature branches
  fix/*        ← Agent or human fix branches
  orchestrator/* ← Branches created by the orchestrator
  release/*    ← Release branches (tag-triggered)
```

### 4.2 Branch Protection Requirements (main)
- Require PR before merging: **Yes**
- Require status checks to pass: **Yes**
- Require conversation resolution: **Yes**
- Allow force pushes: **No**
- Allow deletions: **No**

### 4.3 Required Files
Every governed repository must maintain:

| File | Purpose |
|------|---------|
| `README.md` | ≥ 100 chars; project overview |
| `SECURITY.md` | Vulnerability disclosure policy |
| `LICENSE` | Open source licence |
| `CONTRIBUTING.md` | Contribution guidelines |

TAP validation checks for these files on every cycle.

---

## 5. Secret Management Policy

1. **GitHub App credentials** (`GITHUB_APP_ID`, `GITHUB_APP_PRIVATE_KEY`) are
   the only long-term machine credentials permitted.  PATs are forbidden in
   workflows.
2. **All secrets** are stored in GitHub Secrets (org or repo level).
3. **Secrets are never echoed** to workflow logs.  Use `Invoke-MaskSecret` or
   `::add-mask::` immediately after access.
4. **Rotation schedule**: GitHub App private keys rotate every 90 days.
   Cloudflare tokens rotate every 90 days.  OpenAI keys rotate every 30 days.
5. **Secret scanning** is enabled on all repositories.  Alerts are reviewed
   within 24 hours.

---

## 6. Change Management

### 6.1 Autonomous Changes
Changes generated by the autonomous engine follow this path:
```
Idea Discovery → Scoring (≥0.6 threshold) → Sandbox Build
    → TAP Validation Gate → PR Creation → Auto-Merge (if TAP passed)
```

### 6.2 Human-Initiated Changes
Standard GitHub flow: branch → commit → PR → review → merge.

### 6.3 Emergency Changes
Direct pushes to `main` are forbidden except by the Sovereign Owner.
Emergency changes must be followed by a post-incident issue within 24 hours.

---

## 7. Audit & Telemetry

All autonomous actions are logged to `logs/telemetry/run-{run_id}.json`.
Each log entry must contain:

```json
{
  "run_id": "...",
  "timestamp": "...",
  "trigger": "schedule|workflow_dispatch|push|...",
  "actor": "github-actions[bot]|infinity-orchestrator[bot]",
  "action": "...",
  "target_repo": "...",
  "target_branch": "...",
  "outcome": "success|failure|skipped",
  "tap_passed": true
}
```

Telemetry is committed to the repository on every autonomous run.

---

## 8. Connector Governance

All external API connections (Cloudflare, OpenAI, GitHub, VS Code) must be:

1. **Registered** in `.infinity/connectors/endpoint-registry.json`
2. **Authenticated** via the method defined in `auth-matrix.md`
3. **Rate-limited** to respect API quotas (see connector-specific configs)
4. **Monitored** — connection failures trigger health alerts

Unregistered or unauthenticated API calls are a TAP violation.

---

## 9. Policy Change Process

Changes to this governance framework require:
1. A PR authored by a human (not an agent)
2. Review by the Sovereign Owner or an Org Admin
3. TAP validation passing on the PR
4. The PR must update `ACTIVE_MEMORY.md` notes section

No agent may autonomously modify governance policies.

---

## Related Documents

| Document | Location |
|----------|---------|
| TAP Protocol | `.infinity/policies/tap-protocol.md` |
| Guardrails | `.infinity/policies/guardrails.md` |
| Auth Matrix | `.infinity/connectors/auth-matrix.md` |
| Agent Entrypoint | `AGENT_ENTRYPOINT.md` |
| GitHub App Manifest | `config/github-app-manifest.json` |
